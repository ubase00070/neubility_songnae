<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <title>Just an Internal Tool</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 15px; background-color: #EFE9D9; color: #333; margin: 0; }
        /* ê·¸ë¦¬ë“œ ì¡°ì •: ì™¼ìª½ì„ ì‚´ì§ ì¤„ì—¬ì„œ í”„ë¦¬ë·° ê³µê°„ í™•ë³´ */
        .main-wrapper { display: grid; gap: 15px; max-width: 1400px; margin: auto; grid-template-areas: "person preview" "units units" "extra extra"; grid-template-columns: 0.92fr 1.08fr; }
        .person-section { grid-area: person; } .preview-section { grid-area: preview; } .units-section { grid-area: units; } .extra-section { grid-area: extra; }
        .section { background: #FDFCF0; padding: 15px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #e9e4d9; height: fit-content; }
        .half-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .section-title { font-weight: bold; display: block; color: #495057; border-left: 4px solid #adb5bd; padding-left: 8px; font-size: 0.85rem; }
        
        button.unit-btn { padding: 5px 9px; border: 1px solid #e9ecef; background: #fff; cursor: pointer; border: 1px solid #ced4da; border-radius: 4px; font-size: 12px; font-weight: 500; color: #444; border-bottom-width: 3.5px !important; border-bottom-style: solid !important; box-sizing: border-box; transition: background-color 0.1s; transform: none !important; margin: 2px; position: relative; }
        button.unit-btn:disabled { cursor: not-allowed; opacity: 0.6; }
        .reset-btn { font-size: 11px; padding: 2px 10px; border-radius: 20px; border: 1px solid #ced4da; background: #fff; color: #868e96; cursor: pointer; }
        button.unit-btn.next-highlight { background-color: #34f84f !important; border-color: #b2f2bb !important; color: #222 !important; font-weight: bold !important; box-shadow: 0 0 8px #d3f9d8; animation: highlight-pulse 2s infinite; }
        button.unit-btn.active { border: 1px solid #222 !important; border-bottom-width: 4px !important; font-weight: bold !important; background-color: #4dabf7 !important; color: white !important; }
        
        .red-dot { position: absolute; top: -0px; right: -0px; width: 6px; height: 6px; background-color: #ff4d4f; border-radius: 50%; box-shadow: 0 0 5px rgba(255, 77, 79, 0.8); animation: dot-pulse 1.5s infinite; }
        @keyframes dot-pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.3); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }

        /* í”„ë¦¬ë·° ì»¨í…Œì´ë„ˆì— ìœ„ì¹˜ ê¸°ì¤€(relative) ì„¤ì • */
        #preview { 
            position: relative; /* í•˜ë‹¨ ë¬¸êµ¬ ë°°ì¹˜ë¥¼ ìœ„í•´ ì¶”ê°€ */
            background: #FFFFFF; 
            color: #1D1C1D;      
            border: 1px solid #35373B;
            border-radius: 8px;
            padding: 20px;
            padding-bottom: 40px; /* í•˜ë‹¨ ë¬¸êµ¬ê°€ ë“¤ì–´ê°ˆ ê³µê°„ í™•ë³´ */
            white-space: pre-wrap;
            font-family: 'Segoe UI', Slack-Lato, AppleColorEmoji, sans-serif; 
            font-size: 15px;      
            line-height: 1.6;
            min-height: 180px;
            letter-spacing: -0.2px;
        }

        .slack-mention {
            background: rgba(29, 155, 209, 0.1); 
            color: #1D9BD1; 
            padding: 0px 4px;
            border-radius: 4px;
            font-weight: 700;
            display: inline-block;
        }

        /* [ë³´ì™„] IDê°€ í™”ë©´ í”„ë¦¬ë·°ì—ì„œ í…ìŠ¤íŠ¸ë¡œ ë³´ì´ì§€ ì•Šê²Œ ìˆ¨ê¹€ */
        .hidden-id {
            display: none;
        }

        .slack-time {
            color: #1D9BD1;
            font-size: 14px;
            margin-left: 2px;
        }

        #note-popup {
            position: absolute; width: 280px; background: #333; color: #fff; padding: 15px; border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 13px; line-height: 1.5;
            display: none; z-index: 9999; border-left: 5px solid #ffdeeb; pointer-events: none;
        }
        #note-popup b { color: #ffdeeb; display: block; margin-bottom: 5px; }

        @keyframes highlight-pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .time-07 { border-bottom-color: #ffff33 !important; } .time-08 { border-bottom-color: #ffcc66 !important; } .time-09 { border-bottom-color: #ffa468 !important; } .time-11 { border-bottom-color: #99ff99 !important; } .time-13 { border-bottom-color: #5ddf1c !important; } .time-14 { border-bottom-color: #99ffff !important; } .time-15 { border-bottom-color: #3582d4 !important; } .time-18 { border-bottom-color: #3434fc !important; } .time-20 { border-bottom-color: #ffccff !important; } .time-22 { border-bottom-color: #fb68b1 !important; } .time-23 { border-bottom-color: #ca2e62 !important; } .time-none { border-bottom-color: #dee2e6 !important; }
        
        .copy-btn { padding: 5px 22px; background: #37b24d; color: white; border: none; border-radius: 6px; font-size: 12px; font-weight: bold; cursor: pointer; }
        .copy-btn.is-active { background-color: #4dabf7 !important; }
        .user-save-zone { font-size: 11px; display: flex; align-items: center; gap: 5px; background: #f1f3f5; padding: 6px 10px; border-radius: 4px; border: 1px solid #dee2e6; }
        .user-save-zone input, .user-save-zone select { border: 1px solid #ced4da; border-radius: 3px; padding: 2px 5px; font-size: 11px; }

        /* ì¶”ê°€ëœ ë³´ì¡° íƒ€ì´í‹€ ìŠ¤íƒ€ì¼ */
        .sub-group-title { font-size: 11px; color: #868e96; margin: 3px 0 2px 1px; font-weight: bold; display: flex; align-items: center; gap: 4px; }
    </style>
</head>
<body>

<div id="note-popup"></div>

<div class="main-wrapper">
    <div class="section person-section">
        <div class="section-header">
            <span class="section-title">[1] êµëŒ€ ê´€ì œì‚¬</span>
            <div class="user-save-zone">
                <span>ì„±ëª…:</span><input type="text" id="my-name-input" oninput="handleNameInput()" placeholder="ì…ë ¥ ì‹œ ì €ì¥ë¨">
            </div>
        </div>
        <hr style="border: 0; border-top: 1px dashed #e9e4d9; margin: 3px 0;">
        <div class="sub-group-title">â˜€ï¸ ì£¼ê°„ ì¶œê·¼ì (07ì‹œ ~ 15ì‹œ)</div>
        <hr style="border: 0; border-top: 1px dashed #e9e4d9; margin: 3px 0;">
        <div class="btn-group" id="person-day-container"></div>
        
        <hr style="border: 0; border-top: 1px dashed #e9e4d9; margin: 3px 0;">
        <div class="sub-group-title">ğŸŒ™ ì•¼ê°„ ì¶œê·¼ì (18ì‹œ - 23ì‹œ ë°˜)</div>
        <hr style="border: 0; border-top: 1px dashed #e9e4d9; margin: 3px 0;">
        <div class="btn-group" id="person-night-container"></div>
    </div>

    <div class="section preview-section">
        <div class="preview-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <span class="section-title" style="border-color: #37b24d;">ì†Œì†Œí•œ ë‚´ë¶€ ë„êµ¬ v1.4 (260201 Updated)</span>
            <button class="copy-btn" id="copyBtn" onclick="copyToClipboard()">ë³µì‚¬í•˜ê¸°</button>
        </div>
        <div id="preview"></div>
    </div>

    <div class="units-section">
        <div class="half-grid">
            <div class="section">
                <div class="section-header"><span class="section-title">[2] ëª¨ë‹ˆí„°ë§ ì¤‘ì¸ ê¸°ì²´</span><button class="reset-btn" onclick="resetSection('shift')">ì „ì²´ í•´ì œ</button></div>
                <div class="btn-group" id="shift-container"></div>
            </div>
            <div class="section">
                <div class="section-header"><span class="section-title">[3] ì˜ˆì • (ğŸŸ¢: ${currentH}ì‹œ ì˜ˆì •)</span><button class="reset-btn" onclick="resetSection('plan')">ì „ì²´ í•´ì œ</button></div>
                <div class="btn-group" id="plan-container"></div>
            </div>
        </div>
    </div>

    <div class="extra-section">
        <div class="half-grid">
            <div class="section">
                <div class="section-header"><span class="section-title">[4] ì¶œì°¨ ì˜ˆì • (ğŸŸ¢)</span><button class="reset-btn" onclick="resetSection('out')">ì „ì²´ í•´ì œ</button></div>
                <div class="btn-group" id="out-container"></div>
            </div>
            <div class="section">
                <div class="section-header"><span class="section-title">[5] ì‚¬ìš© ì¤‘ì¸ ë©€í‹° ê³„ì •</span><button class="reset-btn" onclick="resetSection('account')">ì „ì²´ í•´ì œ</button></div>
                <div class="btn-group" id="account-container">
                    <button class="unit-btn time-none" id="acc-01" onclick="toggleAccount('01')">ê³„ì • 01</button>
                    <button class="unit-btn time-none" id="acc-02" onclick="toggleAccount('02')">ê³„ì • 02</button>
                </div>
            </div>
        </div> 
        <div class="manual-section" style="margin-top:15px; padding:15px; background-color:#fff; border:1px dashed #e9e4d9; border-radius:12px; font-size:13px; line-height:1.6; color:#495057;">
            <div style="font-weight:bold; margin-bottom:8px; color:#222;">[ Notes ]</div>
            <span> â€¢ ê·¼ë¬´ ì‹œê°„ ê·¸ë£¹ ìˆœì„œë³„ ì •ë ¬ / ìµœëŒ€ 2ëª… ì„ íƒ ê°€ëŠ¥</span><br>
            <span> â€¢ ë™ì¼ ì‚¬ì´íŠ¸ ì„ íƒ ì‹œ ìë™ ë¬¶ì„ / íŠ¹ì • ê¸°ì²´ íœ´ë¬´ì¼ ì ìš©</span><br>
            <span> â€¢ ê¸°ì²´ íŠ¹ì´ì‚¬í•­ í•˜ë‹¨ íŒì—… / <b style="color:#ff4d4f;">ì‹ ê·œ ì‚¬ì´íŠ¸</b>ëŠ” ìš°ìƒë‹¨ ì ë©¸ í‘œì‹œ</span><br>
            <span> â€¢ ëª¨ë‹ˆí„°ë§ í•œ ë²ˆì— ë°›ëŠ” ê¸°ëŠ¥ êµ¬í˜„í•´ì¤€ë‹¤ê³  í•©ë‹ˆë‹¤(ë¯¿ì–´ë„ ë ê¹Œìš”?). </span>
        </div>
    </div>
</div>

<script>

    const personnelData = [
        { name: "ê¹€ì§€í›ˆ", time: "(0700-1600)(U)", class: "time-07", id: "U07LD5HA6KC" }, 
        { name: "ì˜¤ì •í›ˆ", time: "(0700-1600)(U)", class: "time-07", id: "U081BN7R3FX" }, 
        { name: "ê°•ìƒìœ¤", time: "(0700-1600)(U)", class: "time-07", id: "U0A5CQVK8E5" }, 
        { name: "ë°•ê³„ì›", time: "(0800-1700)(U)", class: "time-08", id: "U07RUM3AMCP" }, 
        { name: "ë°•íš¨ì„ ", time: "(0800-1700)(U)", class: "time-08", id: "U07PFT5K2GN" }, 
        { name: "ì‹ ì§€ì„­", time: "(0900-1800)(U)", class: "time-09", id: "U07KCEM6DU7" }, 
        { name: "ì•ˆí˜œë¦¼", time: "(0900-1800)(U)", class: "time-09", id: "U07SD6LAGFJ" }, 
        { name: "ê¹€ê²½í™˜", time: "(0900-1800)(U)", class: "time-09", id: "U0837ER4DH7" }, 
        { name: "ìµœìœ¤í˜", time: "(0900-1800)(U)", class: "time-09", id: "U09LVJW0LTD" }, 
        { name: "ì´ê¸¸ë²”", time: "(0900-1800)(U)", class: "time-09", id: "U09TAQYHAAJ" }, 
        { name: "ë°•ì€ì„ ", time: "(1100-2000)(U)", class: "time-11", id: "U07L9T58G3E" }, 
        { name: "ì†¡ì£¼í˜„", time: "(1100-2000)(U)", class: "time-11", id: "U0833HRE3QD" }, 
        { name: "ì¥ì¬ì›", time: "(1100-2000)(U)", class: "time-11", id: "U0876898WG6" }, 
        { name: "ì´í™˜", time: "(1100-2000)(U)", class: "time-11", id: "U08L5G3E63Z" }, 
        { name: "ë°•í˜œì˜", time: "(1100-2000)(U)", class: "time-11", id: "U0A53F3BJ84" }, 
        { name: "ê¹€ë™ì§„", time: "(1100-2000)(U)", class: "time-11", id: "U0A75MK1TND" }, 
        { name: "ì‹ ì€ì •", time: "(1300-2200)(U)", class: "time-13", id: "U0A4XRZG3BQ" }, 
        { name: "ì‹ í˜„ì² ", time: "(1300-2200)(U)", class: "time-13", id: "U09N857TDQU" }, 
        { name: "ì´ë„ì—°", time: "(1300-2200)(U)", class: "time-13", id: "U09LPCHL8TW" }, 
        { name: "ë°•íš¨ë¹ˆ", time: "(1400-2300)(U)", class: "time-14", id: "U0A32RYP77F" }, 
        { name: "ê¹€ê°€ì€", time: "(1500-2400)(U)", class: "time-15", id: "U0A152QPH16" }, 
        { name: "ì„œí˜•ë¯¼", time: "(1500-2400)(U)", class: "time-15", id: "U0A0ANUTX5G" }, 
        { name: "ìµœì„±í™˜", time: "(1500-2400)(U)", class: "time-15", id: "U07FBS6APHA" }, 
        { name: "ë°•ìˆ˜ì—°", time: "(1800-0300)(U)", class: "time-18", id: "U07E7AMFUQ2" }, 
        { name: "ì´ê·œìˆœ", time: "(1800-0300)(U)", class: "time-18", id: "U081BN70T0D" }, 
        { name: "ê°•ì² í™˜", time: "(1800-0300)(U)", class: "time-18", id: "U0854PMM3B3" }, 
        { name: "ê¹€ì†Œì—°", time: "(2000-0500)(U)", class: "time-20", id: "U08552CSB3K" }, 
        { name: "ìµœì„ í˜¸", time: "(2000-0500)(U)", class: "time-20", id: "U07EL0TSG0H" }, 
        { name: "ìµœì •ê¸°", time: "(2000-0500)(U)", class: "time-20", id: "U07EW4HTGCQ" }, 
        { name: "ê³ ìƒì—°", time: "(2200-0700)(U)", class: "time-22", id: "U08LT371YDU" }, 
        { name: "ì„ë‹¤ì—°", time: "(2200-0700)(U)", class: "time-22", id: "U07MBG99B1S" }, 
        { name: "ì„ì•„ì—°", time: "(2200-0700)(U)", class: "time-22", id: "U07MMMNQZ1P" }, 
        { name: "ì•ˆëŒ€ê´€", time: "(2330-0830)(U)", class: "time-23", id: "U07E4DMLYR3" }
    ];    const rawUnits = ["ìš©ì¸ ê³ ì§„", "ì„œê°•ëŒ€", "ê²½í¬ëŒ€ 1", "ê²½í¬ëŒ€ 2", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ì„±ë‚¨ 202", "ì„±ë‚¨ 203", "ë¶€ì‚° 1", "ë¶€ì‚° 2", "ë¶€ì‚° 3", "ë¶€ì‚° 4", "íŒŒì£¼", "ë¦¬ì„¼ì¸  1", "ë¦¬ì„¼ì¸  2", "í‰íƒ 1", "í‰íƒ 2", "ë¶€ì‚° ì„œë©´", "ë¶€ì²œ ì¤‘ë™", "ë‘ë£¨ì•„ì´ 5", "ì¸ë ¥ê°œë°œì›", "ì—˜ìŠ¤ 1", "ì—˜ìŠ¤ 2", "ì†¡ë„ êµ­ìº ", "ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02", "ê¹€í¬ 1", "ê¹€í¬ 2", "í‰íƒ ì§€ì œ", "ë‘ë£¨ì•„ì´ 3", "ì‰´ë”ìŠ¤", "ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ì „ì£¼ì²œ", "ì•„ì£¼ëŒ€ 1", "ì•„ì£¼ëŒ€ 2", "ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ê°•ì›ëŒ€ 1", "ê°•ì›ëŒ€ 2", "DMZ", "ë¶€ê²½ëŒ€"];
    const outUnitsList = ["ë¶€ì‚° 1", "ë¶€ì‚° 2", "ë¶€ì‚° 3", "ë¶€ì‚° 4", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ì„±ë‚¨ 202", "ì„±ë‚¨ 203", "ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02", "ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ì „ì£¼ì²œ", "ë‘ë£¨ì•„ì´ 5"];

    const unitNotes = {
        "ë¦¬ì„¼ì¸  1": "ë‹¨ì§€ê³µì‚¬ì˜ˆì •<br>ê¸°ì²´ êº¼ë‚´ì ¸ìˆì„ ê²½ìš°ì—ë§Œ ìˆœíšŒ",
        "ë¦¬ì„¼ì¸  2": "ë‹¨ì§€ê³µì‚¬ì˜ˆì •<br>ê¸°ì²´ êº¼ë‚´ì ¸ìˆì„ ê²½ìš°ì—ë§Œ ìˆœíšŒ",
        "ê³ ì–‘ ë˜ë¯¸ì•ˆ": "2ì›”ê¹Œì§€ ìˆœíšŒë³´ë¥˜",
        "ë‘ë£¨ì•„ì´ 5": "ì‹ ê·œ - LIT_ì¸ì²œêµ­ì œê³µí•­ê³µì‚¬",
        "ì¸ë ¥ê°œë°œì›": "ê¸°ì²´ ê³ ì¥",
        "ìš©ì¸ ê³ ì§„": "ë¯¸ë‹ˆë§µ ìœ„ì¹˜ ë¯¸ë…¸ì¶œ ì´ìŠˆ<br>ìˆœíšŒ ë³´ë¥˜",
        "ì„±ë‚¨ 201": "íŒŒì†ìœ¼ë¡œ ìˆœíšŒë³´ë¥˜",
        "íŒŒì£¼": "ë‰´ë¹„ê³  ë¯¸ì—°ë™ìœ¼ë¡œ ì •ìƒí™” ì „ê¹Œì§€ ìˆœíšŒë³´ë¥˜"
    };

    const newUnits = ["ë‘ë£¨ì•„ì´ 5"];

    const timeTable = {
        "07": { plan: ["ìš©ì¸ ê³ ì§„", "ì„œê°•ëŒ€", "ê²½í¬ëŒ€", "ì„±ë‚¨ 202", "ì„±ë‚¨ 203"], out: ["ë¶€ì‚° 1", "ë¶€ì‚° 3"] },
        "08": { plan: ["ë¶€ì‚° 1", "ë¶€ì‚° 3"], out: [] },
        "09": { plan: ["íŒŒì£¼", "ë¦¬ì„¼ì¸  1", "ë¦¬ì„¼ì¸  2", "í‰íƒ 1", "í‰íƒ 2", "DMZ", "ë¶€ì‚° ì„œë©´", "ë¶€ì²œ ì¤‘ë™"], out: ["ë¶€ì‚° 2", "ë¶€ì‚° 4", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ë‘ë£¨ì•„ì´ 5"] },
        "10": { plan: ["ë¶€ì‚° 2", "ë¶€ì‚° 4", "ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ì¸ë ¥ê°œë°œì›", "ì—˜ìŠ¤", "ì†¡ë„ êµ­ìº ", "ë‘ë£¨ì•„ì´ 5"], out: ["ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02"] },
        "11": { plan: ["ë¶€ê²½ëŒ€", "ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02"], out: ["ë¶€ì‚° 1", "ë¶€ì‚° 3"] },
        "12": { plan: ["ë¶€ì‚° 1", "ë¶€ì‚° 3", "íŒŒì£¼"], out: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203"] },
        "13": { plan: ["ì¸ë ¥ê°œë°œì›", "ì„±ë‚¨ 202", "ì„±ë‚¨ 203"], out: ["ë¶€ì‚° 2", "ë¶€ì‚° 4"] },
        "14": { plan: ["ë¶€ì‚° 2", "ë¶€ì‚° 4", "ë¶€ì²œ ì¤‘ë™", "í‰íƒ 1", "í‰íƒ 2", "ë¦¬ì„¼ì¸  1", "ë¦¬ì„¼ì¸  2", "ê¹€í¬ 1", "ê¹€í¬ 2"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "15": { plan: ["íŒŒì£¼", "ì¸ë ¥ê°œë°œì›", "ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ë¶€ì‚° ì„œë©´", "ë‘ë£¨ì•„ì´ 5"], out: ["ë¶€ì‚° 1", "ë¶€ì‚° 3", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201"] },
        "16": { plan: ["ë¶€ì‚° 1", "ë¶€ì‚° 3", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ìš©ì¸ ê³ ì§„", "ì—˜ìŠ¤", "í‰íƒ 1", "í‰íƒ 2"], out: [] },
        "17": { plan: ["í‰íƒ ì§€ì œ"], out: ["ë¶€ì‚° 2", "ë¶€ì‚° 4"] },
        "18": { plan: ["ë¶€ì‚° 2", "ë¶€ì‚° 4", "íŒŒì£¼", "ë‘ë£¨ì•„ì´ 3"], out: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203"] },
        "19": { plan: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203", "ìš©ì¸ ê³ ì§„", "ì—˜ìŠ¤", "ì‰´ë”ìŠ¤"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "20": { plan: ["ë¶€ì²œ ì¤‘ë™", "í‰íƒ ì§€ì œ", "ë¦¬ì„¼ì¸  1", "ë¦¬ì„¼ì¸  2", "ë‘ë£¨ì•„ì´ 3", "ë‘ë£¨ì•„ì´ 5"], out: ["ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02"] },
        "21": { plan: ["ë¶€ì‚° ì„œë©´", "íŒŒì£¼", "ì‰´ë”ìŠ¤", "ìì²´ìˆœì°° 01", "ìì²´ìˆœì°° 02", "ì†¡ë„ êµ­ìº "], out: ["ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ì „ì£¼ì²œ", "ë‘ë£¨ì•„ì´ 5"] },
        "22": { plan: ["ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ë‘ë£¨ì•„ì´ 3", "ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ì „ì£¼ì²œ", "í‰íƒ 1", "í‰íƒ 2", "ì•„ì£¼ëŒ€", "ë‘ë£¨ì•„ì´ 5"], out: [] },
        "23": { plan: ["ìš©ì¸ ê³ ì§„", "í‰íƒ ì§€ì œ", "ì„œê°•ëŒ€", "ì‰´ë”ìŠ¤"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "00": { plan: ["ì—˜ìŠ¤", "íŒŒì£¼", "ë‘ë£¨ì•„ì´ 3", "ë‘ë£¨ì•„ì´ 5"], out: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203", "ë‘ë£¨ì•„ì´ 5"] },
        "01": { plan: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203", "ìš©ì¸ ê³ ì§„", "ê¹€í¬ 1", "ê¹€í¬ 2", "ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ì„œê°•ëŒ€", "ì‰´ë”ìŠ¤", "ë‘ë£¨ì•„ì´ 5"], out: ["ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ë‘ë£¨ì•„ì´ 5"] },
        "02": { plan: ["í‰íƒ ì§€ì œ", "ë‘ë£¨ì•„ì´ 3", "í‰íƒ 1", "í‰íƒ 2", "ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ë‘ë£¨ì•„ì´ 5"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "03": { plan: ["ìš©ì¸ ê³ ì§„", "íŒŒì£¼", "ì„œê°•ëŒ€", "ì‰´ë”ìŠ¤", "ë‘ë£¨ì•„ì´ 5"], out: ["ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ë‘ë£¨ì•„ì´ 5"] },
        "04": { plan: ["ì„±ë‚¨ 200", "ì„±ë‚¨ 201", "ê³ ì–‘ ë˜ë¯¸ì•ˆ", "ë‘ë£¨ì•„ì´ 3", "ë‘ë£¨ì•„ì´ 5"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "05": { plan: ["ìš©ì¸ ê³ ì§„", "í‰íƒ ì§€ì œ", "ì„œê°•ëŒ€", "ì‰´ë”ìŠ¤", "ë‘ë£¨ì•„ì´ 5"], out: ["ë‘ë£¨ì•„ì´ 5"] },
        "06": { plan: ["íŒŒì£¼", "ë‘ë£¨ì•„ì´ 3", "ë‘ë£¨ì•„ì´ 5"], out: ["ì„±ë‚¨ 202", "ì„±ë‚¨ 203"] }
    };

    let selection = { people: [], shift: [], plan: [], out: [], account: [] };
    let copyTimeout;

    function init() {
        document.getElementById('shift-container').innerHTML = "";
        document.getElementById('plan-container').innerHTML = "";
        document.getElementById('out-container').innerHTML = "";
        document.getElementById('person-day-container').innerHTML = "";
        document.getElementById('person-night-container').innerHTML = "";

        const savedName = localStorage.getItem('monitor_my_name');
        if (savedName) document.getElementById('my-name-input').value = savedName;

        const currentDay = new Date().getDay();
        
        // ì¸ì› ë°ì´í„° ë¶„ë¦¬ ë Œë”ë§
        const dayStaff = personnelData.filter(p => {
            const hour = parseInt(p.class.split('-')[1]);
            return hour >= 7 && hour <= 15;
        });
        const nightStaff = personnelData.filter(p => {
            const hour = parseInt(p.class.split('-')[1]);
            return hour >= 18;
        });

        renderContainer('person-day-container', dayStaff.map(p => ({name: p.name, type: 'people', class: p.class})));
        renderContainer('person-night-container', nightStaff.map(p => ({name: p.name, type: 'people', class: p.class})));

        const filterHoliday = (name) => {
            if (currentDay === 2 && (name.includes("ë¶€ì‚° 3") || name.includes("ë¶€ì‚° 4"))) return false;
            if ((currentDay === 0 || currentDay === 6) && (name.includes("ì¸ë ¥ê°œë°œì›") || name.includes("ìì²´ìˆœì°°"))) return false;
            return true;
        };

        const filteredUnits = rawUnits.filter(filterHoliday);
        const unitsOrderFiltered = filteredUnits.map(u => u.replace("ìì²´ìˆœì°°", "ìì²´ìˆœì°° "));

        renderContainer('shift-container', unitsOrderFiltered
        .filter(name => name !== "ë¶€ì‚°êµ­ë¦½ê³¼í•™ê´€") 
        .map(name => ({name, type: 'shift', class: 'time-none'})));
        
        const planData = [];
        const processed = new Set();
        unitsOrderFiltered.forEach(name => {
            if (name === "ë¶€ì‚°êµ­ë¦½ê³¼í•™ê´€") return;
            let displayName = name;
            if (name.includes("ì•„ì£¼ëŒ€")) displayName = "ì•„ì£¼ëŒ€";
            else if (name.includes("ì—˜ìŠ¤")) displayName = "ì—˜ìŠ¤";
            else if (name.includes("ê²½í¬ëŒ€")) displayName = "ê²½í¬ëŒ€";
            else if (name.includes("ê°•ì›ëŒ€")) displayName = "ê°•ì›ëŒ€";
            if (!processed.has(displayName)) {
                planData.push({name: displayName, type: 'plan', class: 'time-none'});
                processed.add(displayName);
            }
        });
        renderContainer('plan-container', planData);

        const filteredOut = outUnitsList.filter(filterHoliday);
        renderContainer('out-container', filteredOut.map(name => ({name: name.replace("ìì²´ìˆœì°°", "ìì²´ìˆœì°° "), type: 'out', class: 'time-none'})));
        
        updatePersonButtonsState();
        applyHighlight(); 
        const currentH = String((new Date().getHours() + 1) % 24).padStart(2, '0');
        document.querySelector('.units-section .section:nth-child(2) .section-title').innerText = `[3] ì˜ˆì • ê¸°ì²´ (ğŸŸ¢: ${currentH}ì‹œ ì˜ˆì • / ğŸ”´: ì‹ ê·œ)`;
        document.querySelector('.extra-section .section:first-child .section-title').innerText = `[4] ì¶œì°¨ ì˜ˆì • ê¸°ì²´ (ğŸŸ¢)`;

        updatePreview();
    }

    function renderContainer(id, data) {
        const container = document.getElementById(id);
        const popup = document.getElementById('note-popup');

        data.forEach(item => {
            const btn = document.createElement('button');
            let extraClass = item.class || 'time-none';
            btn.className = `unit-btn ${extraClass}`;
            btn.textContent = item.name;
            btn.dataset.name = item.name; 

            if (newUnits.includes(item.name)) {
                const dot = document.createElement('span');
                dot.className = 'red-dot';
                btn.appendChild(dot);
            }

            if (item.type !== 'shift') {
                btn.onmouseenter = (e) => {
                    const note = unitNotes[item.name];
                    if (note) {
                        popup.innerHTML = `<b>[${item.name} íŠ¹ì´ì‚¬í•­]</b>${note}`;
                        popup.style.display = 'block';
                        updatePopupPosition(e);
                    }
                };
                btn.onmousemove = (e) => { updatePopupPosition(e); };

                function updatePopupPosition(e) {
                    const padding = 15;
                    const popupWidth = 280;
                    let leftPos = e.pageX + padding;
                    if (leftPos + popupWidth > window.innerWidth) {
                        leftPos = e.pageX - popupWidth - padding;
                    }
                    popup.style.left = leftPos + 'px';
                    popup.style.top = (e.pageY + padding) + 'px';
                }   
                btn.onmouseleave = () => { popup.style.display = 'none'; };
            }

            btn.onclick = () => {
                const arr = selection[item.type];
                const idx = arr.indexOf(item.name);
                if (idx > -1) { arr.splice(idx, 1); btn.classList.remove('active'); }
                else {
                    const inputName = document.getElementById('my-name-input').value.trim();
                    const max = (inputName === "") ? 2 : 1;
                    if (item.type === 'people' && arr.length >= max) return;
                    arr.push(item.name); btn.classList.add('active');
                }
                if (item.type === 'people') updatePersonButtonsState();
                updatePreview();
            };
            container.appendChild(btn);
        });
    }

    function applyHighlight() {
        let baseH = new Date().getHours();
        const nextH = String((baseH + 1) % 24).padStart(2, '0');
        const data = timeTable[nextH];
        
        document.querySelectorAll('.next-highlight').forEach(b => b.classList.remove('next-highlight'));
        if (data) {
            const formatName = (n) => n.replace("ìì²´ìˆœì°°", "ìì²´ìˆœì°° ").trim();
            data.plan.forEach(name => {
                const target = formatName(name);
                const btn = document.querySelector(`#plan-container [data-name="${target}"]`);
                if (btn) btn.classList.add('next-highlight');
            });
            data.out.forEach(name => {
                const target = formatName(name);
                const btn = document.querySelector(`#out-container [data-name="${target}"]`);
                if (btn) btn.classList.add('next-highlight');
            });
        }
    }

    function handleNameInput() {
        localStorage.setItem('monitor_my_name', document.getElementById('my-name-input').value.trim());
        updatePersonButtonsState();
        updatePreview();
    }

    function resetSection(type) {
        selection[type] = [];
        const selector = type === 'account' ? '#account-container .unit-btn' : `#${type}-container .unit-btn`;
        document.querySelectorAll(selector).forEach(btn => {
            btn.classList.remove('active');
        });
        updatePersonButtonsState();
        updatePreview();
    }

    function toggleAccount(val) {
        const btn = document.getElementById(`acc-${val}`);
        const idx = selection.account.indexOf(val);
        if (idx > -1) { selection.account.splice(idx, 1); btn.classList.remove('active'); }
        else { selection.account.push(val); selection.account.sort(); btn.classList.add('active'); }
        updatePreview();
    }

    function updatePersonButtonsState() {
        const inputName = document.getElementById('my-name-input').value.trim();
        const maxLimit = (inputName === "") ? 2 : 1;
        // ë‘ ê°œì˜ ì»¨í…Œì´ë„ˆ ëª¨ë‘ì—ì„œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
        document.querySelectorAll('#person-day-container .unit-btn, #person-night-container .unit-btn').forEach(btn => {
            const isFull = selection.people.length >= maxLimit;
            const isSelected = btn.classList.contains('active');
            btn.disabled = isFull && !isSelected;
        });
    }

    function formatUnitsWithGrouping(selectedArray) {
        if (selectedArray.length === 0) return "-";
        const groups = [];
        const processedIndexes = new Set();

        const excludeGroups = ["ë‘ë£¨ì•„ì´"];
        
        selectedArray.forEach((item, index) => {
            if (processedIndexes.has(index)) return;
            
            const match = item.match(/^(.*)\s(\d+)$/);
            const baseName = match ? match[1] : item;

            // ì˜ˆì™¸ ëª©ë¡ì— í¬í•¨ëœ ì´ë¦„ì´ë©´ ê·¸ë£¹í™” ë¡œì§ì„ ê±´ë„ˆëœ€
            if (excludeGroups.includes(baseName)) {
                groups.push(item);
                processedIndexes.add(index);
                return;
            }
            
            const sameGroup = [];
            selectedArray.forEach((innerItem, innerIndex) => {
                const innerMatch = innerItem.match(/^(.*)\s(\d+)$/);
                if ((innerMatch ? innerMatch[1] : innerItem) === baseName) {
                    sameGroup.push({ num: innerMatch ? innerMatch[2] : "", fullName: innerItem });
                    processedIndexes.add(innerIndex);
                }
            });
            if (sameGroup.length > 1 && sameGroup[0].num !== "") {
                const nums = sameGroup.map(g => g.num).sort((a, b) => parseInt(a) - parseInt(b)).join(", ");
                groups.push(`${baseName} ${nums}`);
            } else { groups.push(sameGroup[0].fullName); }
        });
        return groups.join(" / ");
    }

    function updatePreview() {
        let baseH = new Date().getHours();
        const nextH = (baseH + 1) % 24;
        const h = String(nextH).padStart(2, '0');
        const inputName = document.getElementById('my-name-input').value.trim();
    
        const getP = (name) => { 
            const info = personnelData.find(p => p.name === name); 
            const timeStr = info ? info.time : "";
            
            if (info && info.id) {
                return `<span class="slack-mention">@${name}</span><span class="hidden-id"> <@${info.id}> </span><span class="slack-time">${timeStr}</span>`;
            } else {
                return `<span class="slack-mention">@${name}</span> <span class="slack-time">${timeStr}</span>`;
            }
        };

        let p1 = `<span class="slack-mention">@ë³¸ì¸</span>`, p2 = `<span class="slack-mention">@ëŒ€ê¸°ì</span>`;
    
        if (inputName !== "") {
            p1 = getP(inputName);
            if (selection.people[0]) p2 = getP(selection.people[0]);
        } else {
            if (selection.people[0]) p1 = getP(selection.people[0]);
            if (selection.people[1]) p2 = getP(selection.people[1]);
        }
        

        let lines = [
            `[${h}ì‹œ ë‹¤ì¤‘ ëª¨ë‹ˆí„°ë§ êµëŒ€]`,
            `${p1}  >  ${p2}`,
            `â€¢ êµëŒ€: ${formatUnitsWithGrouping(selection.shift)}`,
            `â€¢ ì˜ˆì •: ${formatUnitsWithGrouping(selection.plan)}`
        ];

        if (selection.out.length > 0) {
            const exUnits = ["ì‹ ë™ë°±", "ì²­ë‹´ ë¥´ì—˜", "ì „ì£¼ì²œ"];
            const out55 = selection.out.filter(u => u.includes("ë‘ë£¨ì•„ì´ 5"));
            const out40 = selection.out.filter(u => exUnits.some(ex => u.includes(ex)));
            const out50 = selection.out.filter(u => !u.includes("ë‘ë£¨ì•„ì´ 5") && !exUnits.some(ex => u.includes(ex)) && u !== "ë¶€ì‚°êµ­ë¦½ê³¼í•™ê´€");
            const outScience = selection.out.filter(u => u === "ë¶€ì‚°êµ­ë¦½ê³¼í•™ê´€");
        
            let outParts = [];
            if (out40.length > 0) outParts.push(`(${h}:40) ${formatUnitsWithGrouping(out40)}`);
            if (out50.length > 0) outParts.push(`(${h}:50) ${formatUnitsWithGrouping(out50)}`);
            if (out55.length > 0) outParts.push(`(${h}:55) ${formatUnitsWithGrouping(out55)}`);             
            if (outScience.length > 0) outParts.push(`(17:30) ë¶€ì‚°êµ­ë¦½ê³¼í•™ê´€ ì£¼ì°¨ ì´ë™`);
            lines.push(`â€¢ ì¶œì°¨: ${outParts.join(" / ")}`);
        }
    
        if (selection.account.length > 0) {
            lines.push(`â€¢ ë©€í‹° ê³„ì • ${selection.account.join(", ")} ì‚¬ìš© ì¤‘`);
        }    
        document.getElementById('preview').innerHTML = lines.join('\n');
    }
    
    function copyToClipboard() {
        const preview = document.getElementById('preview');
        const textToCopy = preview.innerText;

        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea); 
        textarea.select();
        document.execCommand('copy'); 
        document.body.removeChild(textarea);

        const btn = document.getElementById('copyBtn');
        if (copyTimeout) clearTimeout(copyTimeout);
        btn.innerText = "ë³µì‚¬ë¨"; btn.classList.add('is-active');
        copyTimeout = setTimeout(() => { btn.innerText = "ë³µì‚¬í•˜ê¸°"; btn.classList.remove('is-active'); }, 800);
    }

    init();
</script>
</body>
</html>










